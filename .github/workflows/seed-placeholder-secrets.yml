name: Seed Placeholder Secrets

on:
  push:
    branches:
      - chore/day1-boot
  workflow_dispatch:

jobs:
  create-secrets:
    name: Create Placeholder Secrets
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - name: Seed repository secrets with placeholder values
        uses: actions/github-script@v7
        with:
          script: |
            const secrets = {
              DATABASE_URL: 'REPLACE_WITH_DATABASE_URL',
              SUPABASE_URL: 'REPLACE_WITH_SUPABASE_URL',
              SUPABASE_ANON_KEY: 'REPLACE_WITH_SUPABASE_ANON_KEY',
              NEXTAUTH_SECRET: 'REPLACE_WITH_NEXTAUTH_SECRET',
              OCR_SERVICE_URL: 'REPLACE_WITH_OCR_SERVICE_URL'
            };

            const { data: publicKey } = await github.rest.actions.getRepoPublicKey({
              owner: context.repo.owner,
              repo: context.repo.repo
            });

            for (const [name, value] of Object.entries(secrets)) {
              const encrypted = await github.actions.encryptSecret({
                secret: value,
                key: publicKey.key
              });

              await github.rest.actions.createOrUpdateRepoSecret({
                owner: context.repo.owner,
                repo: context.repo.repo,
                secret_name: name,
                encrypted_value: encrypted,
                key_id: publicKey.key_id
              });

              core.info(`Seeded placeholder secret: ${name}`);
            }
